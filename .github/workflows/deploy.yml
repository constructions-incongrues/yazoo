name: Deploy Any Image

# Configures this workflow to run every time a change is pushed to the branch called `release`.
on:
  workflow_dispatch:
    inputs:
      # trunk-ignore(checkov/CKV_GHA_7)
      image_name:
        description: Image Name
        required: true
        default: ghcr.io/constructions-incongrues/yazoo:latest

jobs:
  deploy:
    runs-on: ubuntu-latest
    # trunk-ignore(checkov/CKV2_GHA_1)
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Deploy stack to Portainer
        uses: carlrygart/portainer-stack-deploy@v1
        with:
          portainer-host: ${{ secrets.PORTAINER_HOST }}
          username: ${{ secrets.PORTAINER_USERNAME }}
          password: ${{ secrets.PORTAINER_PASSWORD }}
          stack-name: yazoo
          stack-definition: etc/stack.yaml
          image: ${{ github.event.inputs.image_name }}
          template-variables:
            DIRECTUS_EMAIL=${{ secrets.DIRECTUS_EMAIL }}
            DIRECTUS_PASSWORD=${{ secrets.DIRECTUS_PASSWORD }}
            YOUTUBE_API_KEY=${{ secrets.YOUTUBE_API_KEY }}
