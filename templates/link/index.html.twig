{% extends 'base.html.twig' %}

{% block title %}Link #{{ id }}{% endblock %}

{% block body %}

<div class="container">

    <h1><a href="/">Yazoo</a> Link #{{ id }}</h1>

    <h3>{{ link.title }}</h3>
    <hr>

    <ul>
        <li>URL <code>{{ url }}</code>
        {% if blacklisted %}
            [Blacklisted]
        {% endif %}
        </li>

        <li>Provider : <code>{{ link.provider }}</code></li>
        <li>Status : <code>{{ link.status }}</code></li>
        <li>Canonical <code>{{ link.canonical }}</code></li>

        <li>Title : {{ link.title }}</li>
        <li>Description : {{ link.description }}</li>
        <li>mimetype : {{ link.mimetype }}</li>

        <li><a href="https://www.musiques-incongrues.net/forum/discussion/{{ discussion_id }}/">Discussion #{{ discussion_id }}</a> / Comment #{{ comment_id }}</li>
    </ul>

    <hr>
    <a href="{{url}}" class='btn btn-primary'>Open</a>
    <a href="/link/{{id}}/crawl" class='btn btn-default'>Crawl now</a>
    <a href="/link/{{id}}/delete" class='btn btn-default'>Delete</a>
    <hr>
    <div id="preview">{{preview|raw}}</div>

</div>

<script>
let el=document.getElementById('preview');
//el.innerHTML="<i>fetching preview...</i>";
console.log('fetching preview...');
fetch('/link/{{id}}/embed')
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(data => {
    // Work with the JSON data
    console.log(data); // Output the JSON data to the console
    if(data.html){
      el.innerHTML=data.html;
    }


  })
  .catch(error => {
    console.error('There has been a problem with your fetch operation:', error);
    el.innerHTML=error;
  });

//let htm='<iframe src="https://bandcamp.com/EmbeddedPlayer/v=2/album=660645427/size=large/tracklist=false/artwork=small/" frameborder="0" width="350" height="467" allowTransparency="true"></iframe>';
//let el=document.getElementById('preview');
//el.innerHTML=htm;
</script>

{% endblock %}
